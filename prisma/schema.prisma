datasource db {
  provider     = "mysql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id             Int            @id @default(autoincrement())
  userId         String         @unique
  first_name     String
  last_name      String
  emailAddresses EmailAddress[]
  clients        Client[]
  requests       Request[]
  isBanned       Boolean        @default(false)
  fundTypes      FundType[]

  @@index([userId])
}

model EmailAddress {
  id     Int    @id @default(autoincrement())
  email  String @unique
  userId String
  user   User   @relation(fields: [userId], references: [userId])

  @@index([userId])
}

model Agency {
  id       Int       @id @default(autoincrement())
  name     String
  requests Request[]
}

model Client {
  id          Int       @id @default(autoincrement())
  first_name  String
  last_name   String
  contactInfo String? // Optional contact information
  caseNumber  String? // Optional case number
  dateOfBirth DateTime
  sex         String
  race        String
  userId      String
  user        User      @relation(fields: [userId], references: [userId])
  requests    Request[]

  @@index([userId])
}

model Fund {
  id         Int      @id @default(autoincrement())
  requestId  Int
  request    Request  @relation(fields: [requestId], references: [id])
  fundTypeId Int
  fundType   FundType @relation(fields: [fundTypeId], references: [id])
  amount     Decimal? // Nullable for non-monetary funds like bus passes
  details    String? // JSON string or link to more detailed information

  @@index([requestId, fundTypeId])
}

model FundType {
  id       Int    @id @default(autoincrement())
  typeName String
  funds    Fund[]
  userId   String
  user     User   @relation(fields: [userId], references: [userId])

  @@index([userId])
}

model Request {
  id                  Int                 @id @default(autoincrement())
  clientId            Int
  client              Client              @relation(fields: [clientId], references: [id])
  userId              Int
  user                User                @relation(fields: [userId], references: [id])
  agencyId            Int
  agency              Agency              @relation(fields: [agencyId], references: [id])
  submitted           Boolean             @default(false)
  pendingApproval     Boolean             @default(false)
  approved            Boolean             @default(false)
  pendingPayout       Boolean             @default(false)
  paid                Boolean             @default(false)
  hasPreScreen        Boolean             @default(false)
  hasPostScreen       Boolean             @default(false)
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt
  requestFormAnswer   RequestFormAnswers?
  preScreenAnswer     PreScreenAnswers?
  postScreenAnswer    PostScreenAnswers?
  requestFormAnswerId Int?
  preScreenAnswerId   Int?
  postScreenAnswerId  Int?
  Fund                Fund[]

  @@index([clientId, userId, agencyId])
}

model RequestFormAnswers {
  id        Int      @id @default(autoincrement())
  answers   Json
  createdAt DateTime @default(now())
  requestId Int      @unique
  request   Request  @relation(fields: [requestId], references: [id])

  @@index([requestId])
}

model PreScreenAnswers {
  id        Int      @id @default(autoincrement())
  answers   Json
  createdAt DateTime @default(now())
  requestId Int      @unique
  request   Request  @relation(fields: [requestId], references: [id])

  @@index([requestId])
}

model PostScreenAnswers {
  id        Int      @id @default(autoincrement())
  answers   Json
  createdAt DateTime @default(now())
  requestId Int      @unique
  request   Request  @relation(fields: [requestId], references: [id])

  @@index([requestId])
}
