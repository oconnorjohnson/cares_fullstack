datasource db {
  provider     = "mysql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id             Int            @id @default(autoincrement())
  userId         String         @unique
  first_name     String
  last_name      String
  emailAddresses EmailAddress[]
  clients        Client[]
  requests       Request[]
  isBanned       Boolean        @default(false)
  fundTypes      FundType[]

  @@index([userId])
}

model EmailAddress {
  id     Int    @id @default(autoincrement())
  email  String @unique
  userId String
  user   User   @relation(fields: [userId], references: [userId])

  @@index([userId])
}

model Agency {
  id       Int       @id @default(autoincrement())
  name     String
  requests Request[]
}

model Client {
  id          Int       @id @default(autoincrement())
  first_name  String
  last_name   String
  contactInfo String? // Optional contact information
  caseNumber  String? // Optional case number
  dateOfBirth DateTime
  sex         String
  race        String
  userId      String
  user        User      @relation(fields: [userId], references: [userId])
  requests    Request[]

  @@index([userId])
}

model Fund {
  id         Int      @id @default(autoincrement())
  requestId  Int
  request    Request  @relation(fields: [requestId], references: [id])
  fundTypeId Int
  fundType   FundType @relation(fields: [fundTypeId], references: [id])
  amount     Int
  details    String? // JSON string or link to more detailed information

  @@index([requestId, fundTypeId])
}

model FundType {
  id       Int    @id @default(autoincrement())
  typeName String
  funds    Fund[]
  userId   String
  user     User   @relation(fields: [userId], references: [userId])

  @@index([userId])
}

model Request {
  id                  Int                @id @default(autoincrement())
  clientId            Int
  client              Client             @relation(fields: [clientId], references: [id])
  userId              String
  user                User               @relation(fields: [userId], references: [userId])
  agencyId            Int
  agency              Agency             @relation(fields: [agencyId], references: [id])
  pendingApproval     Boolean            @default(false)
  approved            Boolean            @default(false)
  pendingPayout       Boolean            @default(false)
  paid                Boolean            @default(false)
  hasPreScreen        Boolean            @default(false)
  hasPostScreen       Boolean            @default(false)
  createdAt           DateTime           @default(now())
  details             String
  implementation      String
  sustainability      String
  preScreenAnswer     PreScreenAnswers?
  postScreenAnswer    PostScreenAnswers?
  requestFormAnswerId Int?
  preScreenAnswerId   Int?
  postScreenAnswerId  Int?
  Funds               Fund[]
  SDOHs               SDOH[]
  RFFs                RFF[]

  @@index([clientId, userId, agencyId])
}

model SDOH {
  id        Int     @id @default(autoincrement())
  value     String
  requestId Int
  request   Request @relation(fields: [requestId], references: [id])
}

model RFF {
  id        Int     @id @default(autoincrement())
  value     String
  requestId Int
  request   Request @relation(fields: [requestId], references: [id])
}

model PreScreenAnswers {
  id        Int      @id @default(autoincrement())
  answers   Json
  createdAt DateTime @default(now())
  requestId Int      @unique
  request   Request  @relation(fields: [requestId], references: [id])

  @@index([requestId])
}

model PostScreenAnswers {
  id        Int      @id @default(autoincrement())
  answers   Json
  createdAt DateTime @default(now())
  requestId Int      @unique
  request   Request  @relation(fields: [requestId], references: [id])

  @@index([requestId])
}
